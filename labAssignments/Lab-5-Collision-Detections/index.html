<!DOCTYPE html>

<html>

<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
		canvas {
			border: 1px solid grey; 
		}
    </style>

  </head>

  <body>

    <canvas id="canvas-for-ball"></canvas>

    <script type="text/javascript">
		// Gets a handle to the element with id canvasOne.
		var canvas = document.getElementById("canvas-for-ball");
		// Get a 2D context for the canvas.
		var ctx = canvas.getContext("2d");
		// Make the fill style red.
        var H = 600;
        var W = 600;


        function init() {
            canvas.height = H;
            canvas.width = W;
        } 
        init();

		ctx.fillStyle = "rgb(255, 0, 0)";
        var noClicks = 0;


        
        canvas.height = H;
        canvas.width = W;
        
        
		var gravity = 0.2,
		bounciness = .9;

        function Ball(x,y,r,xVel,yVel, mass) {
        this.x = x;
        this.y = y;
        this.r = r;
        this.xVel = xVel;
        this.yVel = yVel;
        this.mass = mass;
        var color;
        
        this.draw =  function() {
            // begin drawing the path 
            // fill arc circle with fill color and close again so a further drawing does not cause issues
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.r, 0, Math.PI*2, false);
            ctx.stroke();
        }
        this.resize = function(r) {
            // begin drawing the path 
            // fill arc circle with fill color and close again so a further drawing does not cause issues
           this.r = r
        }
        this.move = function(xpos,ypos) {
            // begin drawing the path 
            // fill arc circle with fill color and close again so a further drawing does not cause issues
           this.x += xpos;
           this.y += ypos;
        }
        this.setColor = function(color) {
            // begin drawing the path 
            // fill arc circle with fill color and close again so a further drawing does not cause issues
           this.color = color;
        }
       this.move = function() {
        if (this.position.x + this.r >= canvas.width) {
        this.velocity.x = -this.velocity.x; }
        }

        

        };//end the object

        function update(){
            
        //Clear canvas for new frame
        clearCanvas();
        //draw the ball image
        b1.draw();
        
        // Add velocity to y axis 
        b1.y += b1.yVel;
        //need to add x axis velocity
        b1.x += b1.xVel;

        //b1.yVel += gravity;
        //could add gravity to x to give distorted grav
       

        //Perfect! Now, lets make it rebound when it touches the floor
        if(b1.y + b1.r > H) {
            // First, reposition the ball on top of the floor and then bounce it!
            b1.y = H - b1.r;
           b1.yVel *= -bounciness;
            
            // The bounciness variable denotes how force of bounce.
            // If bounce will be great in some cases may increase in bounce height.
            // If 0, then it will be inelastic.
        }
        else if(b1.y - b1.r < 0) {
            // First, reposition the ball on top of the floor and then bounce it!
            b1.y = 0 + b1.r;
            b1.yVel *= -bounciness;
            
            // The bounciness variable denotes how force of bounce.
            // If bounce will be great in some cases may increase in bounce height.
            // If 0, then it will be inelastic.
        }
        if(b1.x + b1.r > W) {
            // First, reposition the ball on top of the floor and then bounce it!
            b1.x = W - b1.r;
            b1.xVel *= -bounciness;
            
            // The bounciness variable denotes how force of bounce.
            // If bounce will be great in some cases may increase in bounce height.
            // If 0, then it will be inelastic.
        }
        else if(b1.x - b1.r <0) {
            // First, reposition the ball on top of the floor and then bounce it!
            b1.x = 0 + b1.r;
           b1.xVel *= -bounciness;
            
            // The bounciness variable denotes how force of bounce.
            // If bounce will be great in some cases may increase in bounce height.
            // If 0, then it will be inelastic.
        }
        }
    var b1 = new Ball(100,100,30,3,6,10);
    var b2 = new Ball(200,150,20,2,4,5);
    
    function step() {
    b1.draw();
    update();
   // b1.draw();

    b2.draw();

    console.log("Triggered");
   
    
    requestAnimationFrame(step);
    }
    window.requestAnimationFrame(step);
    
    //a function wrapper for the clear function 
    function clearCanvas() {
        ctx.clearRect(0, 0, W, H);
    }
   //updates the ball animation so that the velocity and grav can be applied
    
  
    // Set interval allows us to call the event repeadetly based on time rather than indices
    // in setInterval, 1000/x depicts fps
    //var updateInterval =  setInterval(b1.update, 1000/60);



    canvas.addEventListener("click", function(event) { 
        //Clear the interval for the previous animation
        //We then need to redraw this
        clearInterval(updateInterval);
        clearCanvas();
        //Draw the ball in a new position
        //Position given by user mouseClick
        ctx.beginPath();
        ctx.arc((event.clientX-canvas.offsetLeft), (event.clientY-canvas.offsetTop), ball.r, 0, Math.PI*2);
        ctx.fill();
        //Show the new ball position to user
        console.log(event.clientX-canvas.offsetLeft);
        console.log(event.clientY-canvas.offsetTop);
        noClicks += 1;
        console.log(noClicks);

        //ball.updatePositon(event.clientX-canvas.offsetLeft), (event.clientY-canvas.offsetTop));
        
        ball.x = (event.clientX-canvas.offsetLeft);
        ball.y = (event.clientY-canvas.offsetTop);
        
        //change the x and y values of ball before starting the animation again
        // if we do not do this we will have a ball in one section and the previous animation run again
        setInterval(update, 1000/60);
        
      });

		// Add a Javascript event listener to the keypress event.
		window.addEventListener("keypress", function(event) { 
			// Just log the event to the console.
			console.log(event);
		});

		//keypresses with jQuery
		$(document.body).on('keydown', function(e) {
			console.log(e.which);
			switch (e.which) {

            case 32:
				console.log('Spacebar pressed');
                clearInterval(updateInterval);
                ball.draw();
                
               ball.xVel = 0;
               ball.vy = 0;
				break;
            //User presses Up arrow key, corresponding key num is 38
            case 38:
				console.log('Up arrow key pressed!');
                //Add 1 to the Y velocity 
                
                ball.vy += 1;
                console.log('Y velocity now '+ball.vy);
				break;

            //User presses down arrow key, corresponding key num is 40
            case 40:
				console.log('Down arrow key pressed!');
                ball.vy -= 1;
                console.log('Y velocity now '+ball.vy);
				break;            
			// key code for left arrow
			case 37:
				console.log('left arrow key pressed!');
                ball.xVel = ball.xVel - 2;
                console.log('X velocity now '+ball.xVel);
				break;

			// key code for right arrow
			case 39:
				console.log('right arrow key pressed!');
                 ball.xVel += 1;
                console.log('X velocity now '+ball.xVel);
				break;
			}
		});
    </script>

  </body>

</html>